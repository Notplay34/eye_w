# DEVELOPMENT_LOG.md

**Обязательный журнал разработки проекта.**

---

## Назначение файла

DEVELOPMENT_LOG.md используется для:

- фиксации всех изменений
- описания добавленных фич
- фиксации архитектурных решений
- описания рефакторинга
- записи найденных проблем и их решений
- фиксации изменений в базе данных
- отслеживания эволюции проекта

---

## Правила ведения журнала

1. **Каждое изменение** записывается отдельным блоком.
2. **Нельзя добавлять новую функциональность** без записи в DEVELOPMENT_LOG.md.
3. **При изменении архитектуры** необходимо сначала обновить PROJECT_CONTEXT.md, затем зафиксировать изменение в DEVELOPMENT_LOG.md.
4. **Перед внесением изменений в код:** ознакомиться с PROJECT_CONTEXT.md и текущим DEVELOPMENT_LOG.md.
5. **После изменений** обязательно обновить DEVELOPMENT_LOG.md.

---

## Формат записи

```
[DATE] — Краткое название изменения

**Тип изменения:** Feature | Fix | Refactor | Architecture | Database | Improvement

**Описание:**  
Подробное описание того, что было сделано.

**Причина:**  
Почему это изменение было необходимо.

**Затронутые файлы:**  
- путь/к/файлу

**Связь с PROJECT_CONTEXT.md:**  
Указать разделы, которые были использованы или изменены.
```

---

## Записи

---

### [2025-02-14] — План разработки (DEVELOPMENT_PLAN.md)

**Тип изменения:** Architecture

**Описание:**  
Создан файл DEVELOPMENT_PLAN.md с разбивкой разработки на этапы и небольшие задачи: основа бэкенда (1), заказы и платежи API (2), связка frontend–backend (3), генерация docx (4), сотрудники (5), Telegram-бот павильона 2 (6), бот владельца (7), аналитика API (8), стабилизация (9). Указан порядок выполнения и связи между этапами.

**Причина:**  
Нужен единый понятный план с конкретными шагами для реализации системы по PROJECT_CONTEXT.

**Затронутые файлы:**  
- DEVELOPMENT_PLAN.md (новый)

**Связь с PROJECT_CONTEXT.md:**  
План опирается на разделы 2–13.

---

### [2025-02-14] — Перенос шаблонов в templates/, удаление dist

**Тип изменения:** Refactor

**Описание:**  
Шаблоны docx из dist/main/templates скопированы в папку templates/ в корне проекта. Папка dist удалена. В PROJECT_CONTEXT (раздел 13) указано, что шаблоны хранятся в templates/.

**Причина:**  
Отказ от артефакта старого приложения (dist); сохранение только нужных шаблонов для будущей генерации документов на бэкенде.

**Затронутые файлы:**  
- templates/ (новые: akt_pp.docx, DKP.docx, dkp_dar.docx, dkp_pieces.docx, doverennost.docx, mreo.docx, number.docx, prokuratura.docx, zaiavlenie.docx)
- PROJECT_CONTEXT.md
- dist/ (удалён)

**Связь с PROJECT_CONTEXT.md:**  
Раздел 13 — уточнено расположение шаблонов.

---

### [2025-02-14] — Виртуальное окружение, .gitignore и правило Git-коммитов

**Тип изменения:** Architecture

**Описание:**  
Создано виртуальное окружение Python (`.venv`) в корне проекта. Добавлен `.gitignore` (исключены `.venv`, `dist/`, `__pycache__`, `.env`, IDE/OS-файлы). Добавлено правило в `.cursor/rules/git-commits.mdc`: после каждого крупного изменения выполнять коммит и пуш с грамотным сообщением на русском.

**Причина:**  
Изолированная среда для бэкенда (FastAPI); не коммитить артефакты и лишнее; фиксировать крупные изменения в Git с понятными сообщениями.

**Затронутые файлы:**  
- .gitignore (новый)
- .cursor/rules/git-commits.mdc (новый)
- .venv/ (создано, в .gitignore)

**Связь с PROJECT_CONTEXT.md:**  
Без изменений контекста.

---

### [2025-02-14] — Поля формы из dist и расширение веб-формы

**Тип изменения:** Feature

**Описание:**  
По плейсхолдерам `{{...}}` в шаблонах docx (dist/main/templates, в т.ч. DKP.docx) восстановлен список полей формы. В PROJECT_CONTEXT.md добавлен раздел 13 «Поля формы оператора (по шаблонам dist)». Веб-форма расширена: блоки «Покупатель/клиент» (ФИО, Паспорт, Адрес, Телефон, Комментарий), «Продавец» (ФИО, Паспорт, Адрес), «Транспортное средство» (VIN, Марка модель, Тип ТС, Год выпуска, Двигатель, № шасси, № кузова, Цвет, СРТС, Гос. номер, ПТС), «Услуга и оплата» дополнена полем «Сумма ДКП». Сводка для документов и app.js обновлены под новые поля; одна форма по-прежнему заполняет блоки итогов и превью.

**Причина:**  
Привести веб-форму в соответствие с полями из прежнего приложения (dist), чтобы одна форма заполняла все документы по шаблонам.

**Затронутые файлы:**  
- PROJECT_CONTEXT.md (раздел 13)
- frontend/index.html
- frontend/styles.css
- frontend/app.js

**Связь с PROJECT_CONTEXT.md:**  
Добавлен раздел 13. Использованы разделы 2.1 (Павильон 1), 4.2 (Frontend).

---

### [2025-02-14] — Разделы 8–12 в PROJECT_CONTEXT

**Тип изменения:** Architecture

**Описание:**  
В PROJECT_CONTEXT.md добавлены разделы 8–12 с единым оформлением (заголовки ##, списки): жизненный цикл заказа (Order Lifecycle), логика финансов, роли пользователей, Telegram-бот павильона 2, принцип «Единый источник правды».

**Причина:**  
Включить в основной документ архитектуры ранее описанные правила (статусы заказа, финансы, роли, бот, источник правды), чтобы они были частью единого контекста.

**Затронутые файлы:**  
- PROJECT_CONTEXT.md

**Связь с PROJECT_CONTEXT.md:**  
Добавлены разделы 8–12.

---

### [2025-02-14] — Ссылка на журнал в PROJECT_CONTEXT

**Тип изменения:** Improvement

**Описание:**  
В раздел 7 «Связь с кодом» PROJECT_CONTEXT.md добавлен пункт 4: обращаться к DEVELOPMENT_LOG.md, чтобы учитывать принятые решения, описанные проблемы и их решения и не повторять ошибок.

**Причина:**  
Необходимость явно разрешить и рекомендовать использование журнала как источника опыта проекта при разработке.

**Затронутые файлы:**  
- PROJECT_CONTEXT.md

**Связь с PROJECT_CONTEXT.md:**  
Изменён раздел 7 (связь с кодом).

---

### [2025-02-14] — Введение обязательного журнала разработки

**Тип изменения:** Architecture

**Описание:**  
Создан файл DEVELOPMENT_LOG.md в корне проекта. Определены назначение журнала, правила ведения и формат записей. В журнал внесены ретроспективные записи о ранее выполненных работах (PROJECT_CONTEXT, правило Cursor, веб-форма операторов).

**Причина:**  
Необходимость единого места фиксации эволюции проекта и согласованности с PROJECT_CONTEXT.md.

**Затронутые файлы:**  
- DEVELOPMENT_LOG.md (новый)

**Связь с PROJECT_CONTEXT.md:**  
Раздел 7 (связь с кодом): добавлено требование вести журнал разработки.

---

### [2025-02-14] — Веб-форма для операторов Павильона 1

**Тип изменения:** Feature

**Описание:**  
Добавлено простое веб-приложение для павильона 1 (оформление документов): одна основная форма с полями клиента, типом услуги, госпошлиной, доп. услугами и номером. Блоки «Итого и оплата», «Сводка для документов» и «Документы для печати» заполняются автоматически на основе основной формы. Реализованы кнопки «Принять наличные» и «Печать документов», выбор оператора (localStorage). Список документов привязан к шаблонам из dist/main/templates.

**Причина:**  
Требование PROJECT_CONTEXT: простое веб-приложение для павильона 1; замена/дополнение прежнего десктоп-приложения удобной веб-формой для операторов.

**Затронутые файлы:**  
- frontend/index.html (новый)
- frontend/styles.css (новый)
- frontend/app.js (новый)

**Связь с PROJECT_CONTEXT.md:**  
Разделы 2.1 (Павильон 1), 4.2 (Frontend). Архитектура не менялась.

---

### [2025-02-14] — Правило Cursor «перед написанием кода»

**Тип изменения:** Architecture

**Описание:**  
Создано правило в .cursor/rules/project-context.mdc с alwaysApply: true. Правило обязывает перед написанием кода ознакомляться с PROJECT_CONTEXT.md, проверять соответствие архитектуре, не нарушать структуру проекта, не добавлять лишние зависимости; при необходимости изменений архитектуры — сначала предлагать их, а не менять молча.

**Причина:**  
Обеспечение согласованности разработки с PROJECT_CONTEXT.md.

**Затронутые файлы:**  
- .cursor/rules/project-context.mdc (новый)

**Связь с PROJECT_CONTEXT.md:**  
Используются разделы 1–6 (цели, структура, архитектура, сущности, принципы).

---

### [2025-02-14] — Создание PROJECT_CONTEXT.md

**Тип изменения:** Architecture

**Описание:**  
В корне проекта создан основной документ архитектуры и логики PROJECT_CONTEXT.md: описание проекта, структура бизнеса (павильоны 1 и 2), финансовый учёт, стек (Python/FastAPI/PostgreSQL, веб, Telegram), сущности БД (orders, payments, plates, employees), жизненный цикл заказа, логика финансов, роли, принцип «единый источник правды».

**Причина:**  
Необходимость единого источника правды по архитектуре и логике для дальнейшей разработки.

**Затронутые файлы:**  
- PROJECT_CONTEXT.md (новый)

**Связь с PROJECT_CONTEXT.md:**  
Файл создан; последующие правки расширяли разделы 8–12.

---

*Конец записей. Новые изменения добавляются сверху этого блока (после «## Записи» и разделителя).*
